<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>

	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="author" content="SemiColonWeb" />

	<!-- Stylesheets
	============================================= -->
	<link href="http://fonts.googleapis.com/css?family=Playfair+Display:400,400italic,700italic|Poppins:300,400,500,600,700" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="css/bootstrap.css" type="text/css" />
	<link rel="stylesheet" href="css/
	style.css" type="text/css" />
	<link rel="stylesheet" href="css/dark.css" type="text/css" />
	<link rel="stylesheet" href="css/font-icons.css" type="text/css" />
	<link rel="stylesheet" href="one-page/css/et-line.css" type="text/css" />
	<link rel="stylesheet" href="css/animate.css" type="text/css" />
	<link rel="stylesheet" href="css/magnific-popup.css" type="text/css" />

	<link rel="stylesheet" href="css/responsive.css" type="text/css" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<link rel="stylesheet" href="css/intro-fonts.css" type="text/css" />
	<link rel="stylesheet" href="css/colors.php?color=3EA98D" type="text/css" />

	<!-- Document Title
	============================================= -->
	<title>매칭 페이지</title>

<style>
.iportfolio .portfolio-image { overflow: visible; }

.iportfolio img {
	opacity: 1;
	-webkit-box-shadow: 0 0 1px rgba(0, 0, 0, 0.1), 0 5px 17px rgba(0, 0, 0, 0.15);
	box-shadow: 0 0 1px rgba(0, 0, 0, 0.1), 0 5px 17px rgba(0, 0, 0, 0.15);
	-webkit-transition: opacity .4s ease;
	-o-transition: opacity .4s ease;
	transition: opacity .4s ease;
}

.iportfolio img:hover { opacity: 0.85; }

.iportfolio .portfolio-desc h3 {
	font-weight: 400;
	font-size: 14px;
	text-transform: uppercase;
	letter-spacing: 1px;
	margin-top: 15px;
}

.iportfolio .portfolio-desc h3 a:hover { color: #777; }

.iportfolio .portfolio-desc h3 a span {
	display: inline-block;
	position: relative;
	top: -1px;
	vertical-align: middle;
	margin: 0 0 0 3px;
	font-size: 11px !important;
	padding: 5px 7px;
	font-weight: 400;
	color: #FFF;
	letter-spacing: 0;
	text-transform: none;
}

.testimonials-rating {
	margin-top: 15px;
	color: #FFD700;
	font-size: 18px;
	line-height: 1;
}

.testi-content p {
	font-size: 18px;
	color: #666;
}

.testi-content p:before,
.testi-content p:after { display: none; }

.testi-meta:before { display: none; }
.testi-meta span { padding-left: 0; }

.intro-support-block {
	border-top: 1px solid #EEE;
	overflow: hidden;
}

.intro-support-block > div:before {
	position: absolute;
	content: '';
	top: 0;
	left: -1px;
	width: 0;
	height: 100%;
	border-left: 1px solid #EEE;
}

.intro-support-block a.col-padding {
	display: block;
	-webkit-transition: all .3s ease;
	-o-transition: all .3s ease;
	transition: all .3s ease;
}

.intro-support-block a.col-padding:hover { background-color: #F5F5F5; }

.intro-support-block span {
	display: block;
	font-size: 20px;
	color: #444;
	margin-top: 15px;
}

.device-xs .intro-support-block > div:before,
.device-xxs .intro-support-block > div:before {
	top: -1px;
	left: 0;
	width: 100%;
	height: 0;
	border-left: 0;
	border-top: 1px solid #EEE;
}

#page-menu {
	height: 0;
	overflow: hidden;
	-webkit-backface-visibility: hidden;
}

#page-menu #page-menu-wrap {
	opacity: 0;
	pointer-events: none;
	-webkit-transition: all .4s ease;
	-o-transition: all .4s ease;
	transition: all .4s ease;
	-webkit-transform: translate3d(0,-44px,0);
	-o-transform: translate3d(0,-44px,0);
	transform: translate3d(0,-44px,0);
	transform-style: preserve-3d;
	-webkit-backface-visibility: hidden;
}

#page-menu.sticky-page-menu { overflow: visible; }

#page-menu.sticky-page-menu #page-menu-wrap {
	opacity: 1;
	pointer-events: auto;
	-webkit-transform: translate3d(0,0,0);
	-o-transform: translate3d(0,0,0);
	transform: translate3d(0,0,0);
}
</style>

</head>

<body class="stretched">

	<!-- Document Wrapper
	============================================= -->
	<div id="wrapper" class="clearfix">

		<!-- Header
		============================================= -->
		<header id="header" class="full-header nobottomborder">

			<div id="header-wrap">

				<div class="container clearfix">

					<div id="primary-menu-trigger">
						<i class="icon-reorder hidden-xs"></i>
						<img src="http://ssodam.com/statics/upload/29abfa263b8b11e7976b0242ac110004.png" class='visible-xs' width='14px;'></a>
					</div>

					<!-- Logo
					============================================= -->
					<div id="logo">
						<a href="index.html" class="standard-logo" data-dark-logo="images/logo-dark.png"><img src="http://ssodam.com/statics/upload/5983d1183b8811e7976b0242ac110004.png" alt="Canvas Logo"></a>
						<a href="index.html" class="retina-logo hidden-xs" data-dark-logo="images/logo-dark@2x.png"><img src="http://ssodam.com/statics/upload/29abfa263b8b11e7976b0242ac110004.png" alt="Canvas Logo"></a>
					</div><!-- #logo end -->

					<!-- Primary Navigation
					============================================= -->
					<nav id="primary-menu">

						<ul class='norightmargin' style='border-right : 0px !important;'>
							<li><a href="0-main.html"><div>매칭</div></a></li>
							<li><a href="0-config.html"><div>내역</div></a></li>

						</ul>

					</nav><!-- #primary-menu end -->

				</div>

			</div>

		</header><!-- #header end -->


		<!-- 매칭 돌리는 버튼
		============================================= -->

		<section id="content_1">

			<div class="content-wrap nopadding">

				<div class="section nobg nomargin center clearfix" style="padding: 100px 0;">
					<div class="container clearfix">
						<div class='col_one_fifth hidden-xs'>
						</div>
						<div class="col_three_fifth" >
						<div class="fancy-title title-dotted-border">

							<h3>&nbspMatch Queue</h3>
						</div>
						</div>
						<div class='col_one_fifth'>
						</div>
						<div class="col_three_fifth">
							<div class="fslider">
							<div class="flexslider">
							<a id="queue_start" data-caption-animate="fadeInUp" data-caption-delay="400" href="#" class="button button-3d topmargin fadeInUp animated" data-easing="easeInOutExpo" data-speed="1250" data-scrollto="#conditional-form">상대 찾기</a>
							</div>
						</div>
						<div class = 'topmargin'>
						<a href='0-config.html' style='color : grey; opacity : 0.4; font-size :14px;'>매칭내역 |</a>
						<a href='#myModal' data-lightbox="inline" style='color : grey; opacity : 0.4; font-size :14px;'>도움말</a>
						</div>
								<div class="modal1 mfp-hide" id="myModal">
									<div class="block divcenter" style="background-color: #FFF; max-width: 500px;">
										<div style="padding: 50px;">
											<h3>안내</h3>
											<p class="nobottommargin">매치큐는 하루에 한 번만 돌릴수 있습니다. 매일밤 자정에 큐 권한이 갱신됩니다. 큐를 돌리면 두 개의 팀이 큐에 잡힙니다. 그 중 한 팀을 선택하세요. 상대도 ok하면 서로의 연락처를 알 수 있습니다.</p>
										</div>
										<div class="section center nomargin" style="padding: 30px;">
											<a href="#" class="button" onClick="$.magnificPopup.close();return false;">닫기</a>
										</div>
									</div>
								</div>
					</div>


					</div>
				</div>
			</div>

		</section>

		<!-- 매칭결과 페이지
		============================================= -->
		<section id="match_box" style="margin-bottom: 0px;">

			<div class="content-wrap nopadding">

				<div class="section nobg nomargin center clearfix" style="padding: 50px 0;">
					<div class="container clearfix nopadding">		
						<div class="fancy-title title-dotted-border">
							<h3>&nbsp;SELECT</h3>
						

						</div>

						<div class="col_half">
							<div class="feature-box center media-box fbox-bg">
								<div class="fbox-media" id='match1_select'>
								</div>
								<div class="fbox-desc" id='match1'>
								</div>
							</div>
						</div>
						<div class='visible-xs bottommargin' style='text-align :center;'>VS</div>
						<div class="col_half norightmargin">
							<div class="feature-box center media-box fbox-bg">
								<div class="fbox-media" id='match2_select'>			
								</div>
								<div class="fbox-desc" id='match2'>
								</div>
							</div>
						</div>

						<div class = "col_full">
						<div class="style-msg" style="background-color: #EEE;">
							<div class="sb-msg"><i class="icon-info-sign"></i>한 팀을 선택해주세요. 해당 큐는 매일밤 자정에 만료됩니다. 자정이 되기전에 선택을 완료해주세요,</div>
						</div>
						</div>					
					</div>
				</div>	
							
			</div>

		</section>
		<!-- Footer
		============================================= -->
		<footer id="footer" class="dark">

			<!-- Copyrights
			============================================= -->
			<div id="copyrights">

				<div class="container clearfix">

					<div class="col_half">
						<img src="images/footer-logo.png" alt="Footer Logo" class="footer-logo">

						Copyrights &copy; 2017 All Rights Reserved by RedMirror Inc.
					</div>

					<div class="col_half col_last tright">
						<div class="copyrights-menu copyright-links fright clearfix">
							<a href="#">Home</a>/<a href="#">About</a>/<a href="#">Features</a>/<a href="#">Portfolio</a>/<a href="#">FAQs</a>/<a href="#">Contact</a>
						</div>
						<div class="fright clearfix">
							<a href="#" class="social-icon si-small si-borderless nobottommargin si-facebook">
								<i class="icon-facebook"></i>
								<i class="icon-facebook"></i>
							</a>

						</div>
					</div>

				</div>

			</div><!-- #copyrights end -->

		</footer><!-- #footer end -->


	</div><!-- #wrapper end -->

	<!-- Go To Top
	============================================= -->
	<div id="gotoTop" class="icon-angle-up"></div>

	<script type="text/javascript" src="js/jquery.js"></script>
	<script type="text/javascript" src="js/plugins.js"></script>
	<script type="text/javascript" src="js/functions.js"></script>
	<script src="js/login.js"></script>
	<script>
	var user_id = getCookie("user_id");
	var userNum = getCookie("user_num");
	var requestNum
	// var user_id = "test"
	// var userNum = 16

	$(document).ready(function(){
		if(user_id == "" || userNum ==""){
            location.href = '0-login.html';
        }
		$(document).on("click", "#queue_start", StartQueue)
		default_show()

	})

	function default_show(){
		$("#match_box").show()
		$.ajax({
			url		: 'http://13.124.15.208:9000/queue/',
			//url  :'http://ec2-13-124-98-159.ap-northeast-2.compute.amazonaws.com:9000/queue/',
			dataType: "json",
			type: "GET",
			cache: true,
			jsonp: true,
			jsonpCallback: "",
			data : {
				userNum 	: userNum
			},
			success: function(data){
				console.log(data)

				if(data.type == 1){


					/*대학교 이미지 삽입 */
					if(data.content.m1_user_univ == '서강대학교'){
						var img_src = "<img src='/img/campus/sogang.jpg'>"
					}
					else if (data.content.m1_user_univ == '연세대학교') {
						var img_src = "<img src='/img/campus/yonsei.jpg'>"
					}
					else if (data.content.m1_user_univ == '이화여자대학교') {
						var img_src = "<img src='/img/campus/ewha.jpg'>"
					}
					else if (data.content.m1_user_univ == '홍익대학교') {
						var img_src = "<img src='/img/campus/hongik.jpg'>"
					}

					if(data.content.m2_user_univ == '서강대학교'){
						var img_src2 = "<img src='/img/campus/sogang.jpg'>"
					}
					else if (data.content.m2_user_univ == '연세대학교') {
						var img_src2 = "<img src='/img/campus/yonsei.jpg'>"
					}
					else if (data.content.m2_user_univ == '이화여자대학교') {
						var img_src2 = "<img src='/img/campus/ewha.jpg'>"
					}
					else if (data.content.m2_user_univ == '홍익대학교') {
						var img_src2 = "<img src='/img/campus/hongik.jpg'>"
					}

					/* 이미지 변수 끝 */

					requestNum = data.request_num
					var match1_select = "<a href='#' onclick='MatchRequest("+data.content.m1_user_num+","+ data.request_num+")'>"+img_src+"</a>";
					var match1 = '<h3>'
						match1+= data.content.m1_user_univ;
						match1+= '<span class="subtitle">';
						match1+= data.content.m1_user_age +'세 ' + data.content.m1_user_count + '명'
						match1+= '</span>'
						match1+= '<span class="subtitle" style="opacity:0.7">'
						match1+= data.content.m1_user_concern
						match1+= '</span>'
						match1+= '</h3>'
						match1+= '<br>'
						match1+= "<a href='#' class='button button-border button-rounded button-red' onclick='MatchRequest("+data.content.m1_user_num+","+ data.request_num+")'><i class='icon-off'></i>선택</a>";

					var match2_select = "<a href='#' onclick='MatchRequest("+data.content.m2_user_num+","+ data.request_num+")'>"+img_src2+"</a>";
					var match2 = '<h3>'
						match2+= data.content.m2_user_univ;
						match2+= '<span class="subtitle">';
						match2+= data.content.m2_user_age +'세 ' + data.content.m2_user_count + '명'
						match2+= '</span>'
						match2+= '<span class="subtitle" style="opacity:0.7">'
						match2+= data.content.m2_user_concern
						match2+= '</span>'
						match2+= '</h3>'
						match2+= '<br>'
						match2+= "<a href='#' class='button button-border button-rounded button-red' onclick='MatchRequest("+data.content.m1_user_num+","+ data.request_num+")'><i class='icon-off'></i>선택</a>";

						// $(document).on('dblclick', '#an_tnam tr', function(event) {
    					// 	ADS('hello');
						// });
					// $("#match1-select").click(function(){
					// 	alert("hihi1");
					// 	// MatchRequest(data.content.m1_user_num, data.request_num);
					// });
					// $("#match2-select").click(function(){
					// 	alert("hihi2");
					// 	// MatchRequest(data.content.m2_user_num, data.request_num);
					// });

						// $("#match1_select").click({param1: "hello", param2: "hello"}, MatchRequest);
						// $("#match2_select").click({param1: "hello", param2: "hello"}, MatchRequest);
					$("#match1_select").html(match1_select)
					$("#match2_select").html(match2_select)
					$("#match1").html(match1)
					$("#match2").html(match2)
					$("#queue_start").hide()
					$("#content_1").hide()	


				}
				else{
					$("#match_box").hide()
				}

			},
			error: function() {
				alert("잠시 후 다시 시도해주세요.");
			}
		});
	}

	function StartQueue(){

		if( confirm("매칭을 진행하시겠습니까?") == true){
			$.ajax({
				url : 'http://13.124.15.208:9000/match',
				//url  :'http://ec2-13-124-98-159.ap-northeast-2.compute.amazonaws.com:9000/match',
				dataType: "json",
				type: "GET",
				cache: true,
				jsonp: true,
				jsonpCallback: "",
				data : {
					userNum 	: userNum
				},
				success: function(data){
					console.log(data)
					if(data.type == 1){
						match1_user_num = data.match1.user_num;
						match2_user_num = data.match2.user_num;

						$.ajax({
							url : 'http://13.124.15.208:9000/queue',
							//url  :'http://ec2-13-124-98-159.ap-northeast-2.compute.amazonaws.com:9000/queue',
							dataType: "json",
							type: "POST",
							cache: true,
							jsonp: true,
							jsonpCallback: "",
							data : {
								userNum 	: userNum,
								matchNum1 	: match1_user_num,
								matchNum2 	: match2_user_num
							},
							success: function(data){
								alert("큐가 등록되었습니다.");
								default_show();
							},
							error: function() {
								alert("잠시 후 다시 시도해주세요.");
							}
						});
					}
					else if(data.type == 2){
						alert("오늘은 이미 큐를 돌렸어요. 자정이 지나면 다시 돌릴 수 있어요.")
					}
					else{
						alert("정상적으로 실행이 되지 않습니다.[1]");
					}

				},
				error: function() {
					alert("잠시 후 다시 시도해주세요.");
				}
			});
		}
	}
	function MatchRequest(toUserNum, queueNum){
		if( confirm("해당 팀을 선택하시겠습니까?") == true ){

			$.ajax({
				url : 'http://13.124.15.208:9000/match',
				//url  :'http://ec2-13-124-98-159.ap-northeast-2.compute.amazonaws.com:9000/match',
				dataType: "json",
				type: "POST",
				cache: true,
				jsonp: true,
				jsonpCallback: "",
				data : {
					fromUserNum : userNum,
					toUserNum 	: toUserNum,
					requestNum 	: requestNum
				},
				success: function(data){
					if(data.type == 1){

						$.ajax({
							url	 : 'http://13.124.15.208:9000/queue',
							//url  :'http://ec2-13-124-98-159.ap-northeast-2.compute.amazonaws.com:9000/queue',
							dataType: "json",
							type: "PUT",
							cache: true,
							jsonp: true,
							jsonpCallback: "",
							data : {
								queueNum 	: queueNum
							},
							success: function(data){
								if(data.type == 1){
									alert("미팅신청을 보냈습니다. 상대팀이 수락하면 연락처를 열람할 수 있습니다.")
									location.href = '0-config.html';
								}
							},
							error: function() {
								alert("잠시 후 다시 시도해주세요2.");
							}
						});
						// alert("미팅신청을 보냈습니다3.")
						// location.href = '0-main.html';
					}
				},
				error: function() {
					alert("잠시 후 다시 시도해주세요4.");
				}
			});
		}
	}


	</script>

</body>
</html>