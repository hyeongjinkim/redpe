<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>

	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="author" content="SemiColonWeb" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<!-- 안드로이드 홈화면추가시 상단 주소창 제거 -->
<meta name="mobile-web-app-capable" content="yes">

	<!-- Stylesheets
	============================================= -->
	<link href="http://fonts.googleapis.com/css?family=Lato:300,400,400italic,600,700|Raleway:300,400,500,600,700|Crete+Round:400italic" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="css/bootstrap.css" type="text/css" />
	<link rel="stylesheet" href="css/style.css" type="text/css" />
	<link rel="stylesheet" href="css/dark.css" type="text/css" />
	<link rel="stylesheet" href="css/font-icons.css" type="text/css" />
	<link rel="stylesheet" href="css/animate.css" type="text/css" />
	<link rel="stylesheet" href="css/magnific-popup.css" type="text/css" />

	<link rel="stylesheet" href="http://vitalets.github.io/x-editable/assets/select2/select2.css" type="text/css" />
	<link rel="stylesheet" href="css/components/bs-editable.css" type="text/css" />
	<link href="http://vitalets.github.io/x-editable/assets/x-editable/inputs-ext/typeaheadjs/lib/typeahead.js-bootstrap.css" rel="stylesheet">

	<link rel="stylesheet" href="css/responsive.css" type="text/css" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<!-- Document Title
	============================================= -->
	<title>내 정보 페이지</title>
<style>
.tableicon {
	height : 20px !important;
	right-margin : 8px;

}
</style>

</head>

<body class="stretched">

	<!-- Document Wrapper
	============================================= -->
	<div id="wrapper" class="clearfix">

		<!-- Header
		============================================= -->
		<header id="header" class="full-header nobottomborder">

			<div id="header-wrap">

				<div class="container clearfix">

					<div id="primary-menu-trigger">
						<i class="icon-reorder hidden-xs"></i>
						<img src="http://ssodam.com/statics/upload/29abfa263b8b11e7976b0242ac110004.png" class='visible-xs' width='14px;'></a>
					</div>

					<!-- Logo
					============================================= -->
					<div id="logo">
						<a href="0-login.html" class="standard-logo" data-dark-logo="images/logo-dark.png"><img src="http://ssodam.com/statics/upload/5983d1183b8811e7976b0242ac110004.png" alt="Canvas Logo"></a>
						<a href="0-main.html" class="retina-logo hidden-xs" data-dark-logo="images/logo-dark@2x.png"><img src="http://ssodam.com/statics/upload/29abfa263b8b11e7976b0242ac110004.png" alt="Canvas Logo"></a>
					</div><!-- #logo end -->

					<!-- Primary Navigation
					============================================= -->
					<nav id="primary-menu">

						<ul class='norightmargin' style='border-right : 0px !important;'>
							<li><a href="0-main.html"><div>매칭</div></a></li>
							<li><a href="0-config.html"><div>내역</div></a></li>

						</ul>

						<!-- Top Cart
						============================================= -->



						<!-- Top Search
						============================================= -->


					</nav><!-- #primary-menu end -->

				</div>

			</div>

		</header><!-- #header end -->

		<!-- Content
		============================================= -->
		<section id="content">

			<div class="content-wrap nopadding">

				<div class="container clearfix">

					<div class="row clearfix">

						<div class = 'bottommargin hidden-xs'>
						</div>


						<div class="fancy-title title-dotted-border center">
							<h3>&nbsp;Match List</h3>
						

						</div>

							<div class="clear"></div>

							<div class="row clearfix">

								<div class="col-md-12 nopadding">

									<div class="tabs tabs-bb clearfix" id="tabs-profile">


										<ul class="tab-nav clearfix">
											<li class='noleftmargin'>
												<a href="#tab-1" id='Sreq_btn'>보낸내역</a>
											</li>
											<li>
												<a href="#tab-2" id='Rreq_btn'>받은내역</a>
											</li>
											<li>
												<a href="#tab-3" id='match_btn'>성사내역</a>
											</li>
											<li>
											<a href="#tab-4" id='config_btn'>정보</a>	
											</li>
										

										</ul>
										<div class="tab-container" id="tab-container">

										</div>

									</div>

								</div>

							</div>


						<div class="line visible-xs-block"></div>
					</div>

				</div>

			</div>

		</section><!-- #content end -->

		<!-- Footer
		============================================= -->
		<footer id="footer" class="dark">

				<!-- Copyrights
				============================================= -->
				<div id="copyrights">

					<div class="container clearfix">

						<div class="col_half">
							<img src="images/footer-logo.png" alt="Footer Logo" class="footer-logo">

							Copyrights &copy; 2017 All Rights Reserved by RedMirror Inc.
						</div>

						<div class="col_half col_last tright">
							<div class="copyrights-menu copyright-links fright clearfix">
								<a href="#">Home</a>/<a href="#">About</a>/<a href="#">Features</a>/<a href="#">Portfolio</a>/<a href="#">FAQs</a>/<a href="#">Contact</a>
							</div>
							<div class="fright clearfix">
								<a href="#" class="social-icon si-small si-borderless nobottommargin si-facebook">
									<i class="icon-facebook"></i>
									<i class="icon-facebook"></i>
								</a>

							</div>
						</div>

					</div>

				</div><!-- #copyrights end -->

			</footer><!-- #footer end -->


		</div><!-- #wrapper end -->


	<!-- External JavaScripts
	============================================= -->
	<script src="js/login.js"></script>
	<script type="text/javascript" src="js/jquery.js"></script>
	<script type="text/javascript" src="js/plugins.js"></script>
	<script type="text/javascript" src="http://vitalets.github.io/x-editable/assets/select2/select2.js"></script>
	<script type="text/javascript" src="js/components/bs-editable.js"></script>

	<!-- Footer Scripts
	============================================= -->
	<script type="text/javascript" src="js/functions.js"></script>

	<script>
		jQuery( "#tabs-profile" ).on( "tabsactivate", function( event, ui ) {
			jQuery( '.flexslider .slide' ).resize();
		});
	</script>
	<script>
		var user_id = getCookie("user_id");
		var userNum = getCookie("user_num");
		// var user_id = "test"
		// var userNum = 16

		$(document).ready(function(){

			if(user_id == "" || userNum ==""){
				location.href = '0-login.html';
			}
			else{

				$("#config_btn").click(function(){
					GetConfig(userNum)
				})
				$("#match_btn").click(function(){
					// GetMatchList(userNum, 'S')
					GetData(userNum, 'S')
				})
				$("#Rreq_btn").click(function(){
					// GetRreqList(userNum, 'T')
					GetData(userNum, 'T')
				})
				$("#Sreq_btn").click(function(){
					// GetSreqList(userNum, 'F')
					GetData(userNum, 'F')
				})
				GetData(userNum, 'F')
			}
		})

		$(document).ready(function() {
			$('.bt-phone').editable();
			$('.bt-hash').editable();

			$('.bt-age').editable({
				prepend: "27",  // 현재 설정된 나이값을 불러옴
				source: [
					{value: 20, text: '20'},
					{value: 21, text: '21'},
					{value: 22, text: '22'},
					{value: 23, text: '23'},
					{value: 24, text: '24'},
					{value: 25, text: '25'},
					{value: 26, text: '26'},
					{value: 27, text: '27'},
					{value: 28, text: '28'},
					{value: 29, text: '29'},
					{value: 30, text: '30'},
				],
				display: function(value, sourceData) {
					 var colors = {"": "gray", 1: "green", 2: "blue"},
						 elem = $.grep(sourceData, function(o){return o.value == value;});

					 if(elem.length) {
						 $(this).text(elem[0].text).css("color", colors[value]);
					 } else {
						 $(this).empty();
					 }
				}
			});

			$('.bt-group').editable({
				showbuttons: false,
				source: [
					{value: 1, text: '20'},
					{value: 2, text: '21'},
					{value: 3, text: '22'},
					{value: 4, text: '23'}
				],
			});

			$('.bt-event').editable({
				placement: 'right',
				combodate: {
					firstItem: 'name'
				}
			});



		});

		function GetConfig(userNum){
			$.ajax({
				url     : 'http://13.124.15.208:9000/users/'+userNum,
				//url  :'http://ec2-13-124-98-159.ap-northeast-2.compute.amazonaws.com:9000/users/'+userNum,
				dataType: "json",
				type: "GET",
				cache: true,
				jsonp: true,
				jsonpCallback: "",
				data : {
				},
				success: function(data){

					if(data.type == 1){
						html = '';
						html += '<div class="tab-content clearfix" id="tab-4">'
						html += '<div class="table-responsive">'
						html += '<table class="table table-bordered table-striped">'
						html += '<colgroup>'
						html += '<col class="col-xs-1">'
						html += '<col class="col-xs-7">'
						html += '</colgroup>'
						html += '<thead>'
						html += '<tr>'
						html += '<th>항목</th>'
						html += '<th>내용</th>'
						html += '</tr>'
						html += '</thead>'
						html += '<tbody>'
						html += '<tr>'
						html += '<td> 계정 </td>'
						html += '<td>' + data.content.user_id + '</td>'
						html += '</tr>'
						html += '<tr>'
						html += '<td> 소속 </td>'
						html += '<td>' + data.content.user_univ + '</td>'
						html += '</tr>'
						html += '<tr>'
						html += '<td> 성별 </td>'
						if(data.content.user_gender == 'M'){
							html += '<td>남자</td>';
						}
						else {
							html += '<td>여자</td>';
						};
						html += '</tr>'
						html += '<tr>'
						html += '<td> 연락처 </td>'
						html += '<td><a href="#" class="bt-phone" data-type="text" data-pk="1" data-title="연락처 수정">' +data.content.user_phone +'</a></td>'
						html += '</tr>'
						html += '<tr>'
						html += '<td> 멤버 평균 나이 </td>'
						html += '<td><a href="#" class="bt-age" data-type="select" data-pk="1" data-value="" data-title="나이 수정">'+data.content.user_age+'</a></td>'
						html += '</tr>'
						html += '<tr>'
						html += '<td> 멤버수 </td>'
						html += '<td>'+data.content.user_count+'</td>'
						html += '</tr>'
						html += '<tr>'
						html += '<td> 태그 </td>'
						html += '<td><a href="#" class="bt-hash" data-type="text" data-pk="1" data-title="#공대남자 #잘놈 #술고래">'+data.content.user_concern+'</a></td>'
						html += '</tr>'
						html += '</tbody>'
						html += '</table>'
						html += '</div>'
						html += '</div>'
					}else{

					}
					console.log(html)
	                $("#tab-container").html(html)
				},
				error: function() {
					alert("잠시 후 다시 시도해주세요.");
				}
			});
		}

		function GetData(userNum, pageType){

			$.ajax({
				url     : 'http://13.124.15.208:9000/match/'+userNum,
				//url  :'http://ec2-13-124-98-159.ap-northeast-2.compute.amazonaws.com:9000/match/'+userNum,
				dataType: "json",
				type: "GET",
				cache: true,
				jsonp: true,
				jsonpCallback: "",
				data : {
					pageType : pageType
				},
				success: function(data){
					console.log(data)
					if(data.type == 1){

						// 성사내역
						var html;
						if( pageType == 'S' ){

							var fuser_num;
							var fuser_id;
							var fuser_univ;
							var fuser_phone;
							var fuser_gender;
							var fuser_count;
							var fuser_age;
							var fuser_concern;

							html  = '';
							html += '<div class="tab-content clearfix table-responsive" id="tab-3">'
							html += '<table class="table table-bordered bottommargin">'
							html += '<thead>'
							html += '<tr>'
							html += '<th>no.</th>'
							html += '<th>상대팀 정보</th>'
							html += '<th>#태그 <i class="icon-angle-right infinite animated fadeInLeft"></i></th>'
							html += '<th>연락처</th>'
							html += '</tr>'
							html += '</thead>'
							html += '<tbody>'
							var num = 1;
							if (!data.content.length) {
								html += '<tr>'
								html += '<td colspan = "4">아직 성사내역이 없습니다.</td>'
								html += '</tr>'
								num += 1;

							}
							$.each(data.content, function(i, f) {

								if(f.from_user_num == userNum){
									fuser_num 	= f.to_user_num;
									fuser_id 	= f.to_user_id;
									fuser_univ 	= f.to_user_univ;
									fuser_phone = f.to_user_phone;
									fuser_concern = f.to_user_concern;

 
									fuser_count = '';
									fuser_age 	= f.to_user_age;
									fuser_gender = '';

								}else{
									fuser_num 	= f.from_user_num;
									fuser_id 	= f.from_user_id;
									fuser_univ 	= f.from_user_univ;
									fuser_phone = f.from_user_phone;
									fuser_concern = f.from_user_concern;

									fuser_count = '';
									fuser_age 	= f.to_user_age;
									fuser_gender = '';
								}

								// 성사내역 정보 호출 

								html += '<tr>'
								html += '<td>' + num + '</td>'
								html += '<td>'+fuser_univ+" " + '<span style="font-size :10px; font-color : grey;">('+  fuser_age + '세 3명)</span>' 
								html += '<td><code>'+fuser_concern +'</code></td>'
								html += '<td><img src="/img/message.png" class="tableicon"><a href = "sms:'
								html += fuser_phone
								html += '"> ' + fuser_phone + '</a>'
								html += '</td>'
								html += '</tr>'
								num += 1;

							})
							html += '</tbody>'
							html += '</table>'
							html += '</div>'
							html += '<div class="style-msg" style="background-color: #EEE;"><div class="sb-msg"><i class="icon-info-sign"></i>서로 수락한 매칭입니다.</div></div>'
						

							console.log(html)
						}
						else if( pageType == 'T' ){

							console.log(data)
							// receive
							html  = '';
							html += '<div class="tab-content clearfix table-responsive" id="tab-2">'
							html += '<table class="table table-bordered">'
							html += '<thead>'
							html += '<tr>'
							html += '<th>no.</th>'
							html += '<th>상대팀 정보</th>'
							html += '<th>#태그 <i class="icon-angle-right infinite animated fadeInLeft visible-xs-*"></i></th>'
							html += '<th>수락/거절</th>'
							html += '</tr>'
							html += '</thead>'
							html += '<tbody>'
							var num = 1;
							if (!data.content.length) {
								html += '<tr>'
								html += '<td colspan = "4">아직 신청받은 내역이 없습니다.</td>'
								html += '</tr>'
								num += 1;

							}
							$.each(data.content, function(i, f) {

								html += '<tr>'
								html += '<td>' + num + '</td>'
								html += '<td>' + f.from_user_univ + ' <span style="font-size :10px; font-color : grey;">('+  f.from_user_age + '세 ' + f.from_user_count +'명)</span>'  +'</td>'
								html += '<td><code>' + f.from_user_concern + '</code></td>'

								if(f.success_flag == 0){
									html += '<td>'
									html += '<a href="#" class="button button-3d button-mini button-rounded button-red" onclick="make_match('+f.request_num+',1)">O</a>'
			                        html += '<a href="#" class="button button-3d button-mini button-rounded button-white button-light" onclick="make_match('+f.request_num+',2)">X</a>'
									html += '</td>'
								}
								else if(f.success_flag == 1){
									html += '<td>수락함</td>';
								}
								else if(f.success_flag == 2){
									html += '<td>거절함</td>';
								}

								html += '</tr>'
								num += 1;

							})

							html += '</tbody>'
							html += '</table>'
							html += '</div>'
						}
						else if ( pageType == 'F' ){


							html  = '';
							html += '<div class="tab-content clearfix table-responsive" id="tab-1">'
							html += '<table class="table table-bordered bottommargin">'
							html += '<thead>'
							html += '<tr>'
							html += '<th>no</th>'
							html += '<th>상대팀 정보</th>'
							html += '<th>#태그 <i class="icon-angle-right infinite animated fadeInLeft visible-xs-*"></i></th>'
							html += '<th>상태</th>'
							html += '</tr>'
							html += '</thead>'
							html += '<tbody>'

							var num = 1;
							$.each(data.content, function(i, f) {

								console.log(f)

								html += '<tr>'
								html += '<td>' + num + '</td>'
								html += '<td>' + f.to_user_univ + ' <span style="font-size :10px; font-color : grey;">('+  f.to_user_age + '세 ' + f.to_user_count +'명)</span>'  +'</td>'
								html += '<td><code>' + f.to_user_concern +'</code></td>'

								if(f.success_flag == 0){
									html += '<td>수락 대기중</td>';
								}
								else if(f.success_flag == 1){
									html += '<td>수락됨</td>';
								}
								else if(f.success_flag == 2){
									html += '<td>거절됨</td>';
								}
								else{

								}
								html += '</tr>'

								num += 1;
							})
							html += '</tbody>'
							html += '</table>'
							html += '</div>'
							html += '<div class="style-msg" style="background-color: #EEE;"><div class="sb-msg"><i class="icon-info-sign"></i>미팅 신청을 보낸 내역입니다. 상대방도 수락을 하면 성사내역에서 연락처를 확인할 수 있습니다.</div></div>'
						}
						else{

						}
						$("#tab-container").html(html)
					}
					else{

					}
				},
				error: function() {
					alert("잠시 후 다시 시도해주세요.");
				}
			});

		}

		function make_match(requestNum, matchFlag){
			if(matchFlag == 1){
	            msg = "신청을 수락하시겠습니까?"
	        }
	        else if(matchFlag == 2){
	            msg = "신청을 거절하시겠습니까?"
	        }

	        if( confirm(msg) == true ){
	            $.ajax({
					url     : 'http://13.124.15.208:9000/match/'+requestNum,
	    			//url  :'http://ec2-13-124-98-159.ap-northeast-2.compute.amazonaws.com:9000/match/'+requestNum,
	    			dataType: "json",
	    			type: "PUT",
	    			cache: true,
	    			jsonp: true,
	    			jsonpCallback: "",
	    			data : {
	    				matchFlag : matchFlag
	    			},
	    			success: function(data){
						if( data.type == 1){
							if(matchFlag == 1){
								msg = "수락하였습니다."
							}
							else if(matchFlag == 2){
								msg = "거절하였습니다."
							}
							alert(msg)
							GetData(userNum, 'T')
						}
						else{
							alert("잠시 후 다시 시도해주세요.[1]");
						}
	    			},
	    			error: function() {
	    				alert("잠시 후 다시 시도해주세요.");
	    			}
	    		});
	        }
		}

	</script>

</body>
</html>
